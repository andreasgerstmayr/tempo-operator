apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: tempo
  namespace: kuttl-operator-upgrade
status:
  state: AtLatestKnown
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tempo-operator-controller
  namespace: kuttl-operator-upgrade
status:
  readyReplicas: 1
---
apiVersion: v1
kind: Pod
metadata:
  namespace: kuttl-operator-upgrade
  labels:
    app.kubernetes.io/name: tempo-operator
    control-plane: controller-manager
status:
  containerStatuses:
  # assert that the readiness probes of both containers (kube-rbac-proxy and tempo-operator) are successful
  - ready: true
  - ready: true
---
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
commands:
# kuttl will retry this command until a timeout is reached, and it won't stop retrying if the webhook is not reachable.
# This makes sure that the operator is ready and accepting new TempoStack CRs.
- command: kubectl apply -f tests/e2e-upgrade/upgrade/tempostack.yaml
  namespaced: true
- command: kubectl delete tempo check-operator-ready
  namespaced: true
